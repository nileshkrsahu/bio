<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mental Wellbeing Tasks</title>
  <style>
    /* =============== Global Reset & Body Styling =============== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      background: linear-gradient(to right, #c9d6ff, #e2e2e2);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 30px;
      color: #333;
    }
    /* =============== Container & Heading =============== */
    .container {
      background-color: #fff;
      width: 90%;
      max-width: 1400px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 30px;
      overflow-x: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
      color: #4a4a4a;
    }
    /* =============== Table Styling =============== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      table-layout: auto;
    }
    thead {
      background-color: #f5f5f5;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      vertical-align: middle;
      white-space: normal;
    }
    th {
      font-weight: 600;
    }
    td {
      transition: background-color 0.3s ease;
    }
    .category-cell {
      font-weight: bold;
      text-align: left;
      width: 180px;
    }
    /* =============== Select Element =============== */
    select {
      width: 80px;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    /* =============== Form Fields =============== */
    .form-fields {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .form-fields label {
      font-weight: 500;
      margin-right: 8px;
    }
    .form-fields input {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* =============== Submit Button =============== */
    button {
      display: block;
      margin: 0 auto 20px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      background-color: #4caf50;
      border: none;
      border-radius: 4px;
      color: #fff;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #43a047;
    }
    button:active {
      background-color: #388e3c;
    }
    /* =============== Responsive Table (Optional) =============== */
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
        width: 100%;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr {
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
      }
      td {
        border: none;
        position: relative;
        padding-left: 50%;
        text-align: left;
        margin-bottom: 10px;
      }
      td::before {
        position: absolute;
        left: 10px;
        width: 45%;
        white-space: nowrap;
        font-weight: 600;
      }
      td:nth-of-type(1)::before { content: "Category"; }
      td:nth-of-type(2)::before { content: "Task"; }
      td:nth-of-type(3)::before { content: "Attending Lecture"; }
      td:nth-of-type(4)::before { content: "Exercise"; }
      td:nth-of-type(5)::before { content: "Relaxing"; }
      td:nth-of-type(6)::before { content: "E-Rick or Auto"; }
      td:nth-of-type(7)::before { content: "Cycling"; }
      td:nth-of-type(8)::before { content: "Walking"; }
      td:nth-of-type(9)::before { content: "Running"; }
      td:nth-of-type(10)::before { content: "Studying"; }
      td:nth-of-type(11)::before { content: "Eating"; }
      td:nth-of-type(12)::before { content: "Standing"; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Please select Yes/No from the drop-down showcasing your personal opinion on whether you think the given task is possible or not in the given context. Context names are the column name, and the row consists of mental well-being tasks.</h1>
    <form id="wellbeingForm" action="https://jsttjfi7za.execute-api.ap-south-1.amazonaws.com/ProcessWellbeingSubmission" method="POST" enctype="application/x-www-form-urlencoded">
      <table id="tasksTable">
        <thead>
          <tr>
            <th>Category</th>
            <th>Mental Wellbeing Task</th>
            <th>Attending<br/>Lecture</th>
            <th>Exercise</th>
            <th>Relaxing</th>
            <th>E-Rick<br/>or Auto</th>
            <th>Cycling</th>
            <th>Walking</th>
            <th>Running</th>
            <th>Studying</th>
            <th>Eating</th>
            <th>Standing</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- Name & Email Fields (compulsory) -->
      <div class="form-fields">
        <label for="nameField">Name:</label>
        <input type="text" id="nameField" name="userName" placeholder="Your Name" required>
        <label for="emailField">Email:</label>
        <input type="email" id="emailField" name="userEmail" placeholder="you@example.com" required>
      </div>

      <button type="submit">Submit</button>
    </form>
  </div>

  <script>
    // 1) Define contexts (column headers after "Mental Wellbeing Task")
    const contexts = [
      "Attending Lecture",
      "Exercise",
      "Relaxing",
      "E-Rick / Auto",
      "Cycling",
      "Walking",
      "Running",
      "Studying",
      "Eating",
      "Standing"
    ];

    // 2) Define tasks grouped by category
    const tasksData = [
      {
        category: "Physical activities",
        tasks: [
          "Breathing Exercise",
          "Doing Simple Neck Rolls to Release Tension",
          "Go for a small walk",
          "Stretching"
        ]
      },
      {
        category: "Mental Relaxation",
        tasks: [
          "Close your eyes and try to hear ambient sounds",
          "Listening to Music",
          "Watching funny videos",
          "Watching motivational video"
        ]
      },
      {
        category: "Cognitive Activities",
        tasks: [
          "Journal Writing",
          "Make a list of positive things inside you",
          "Play game",
          "Writing Down a Worry and Putting It Aside"
        ]
      },
      {
        category: "Emotional and Social Engagement",
        tasks: [
          "Calling or texting loved ones",
          "Eating something you like",
          "Observe your surroundings",
          "Scroll through old memories from your gallery"
        ]
      }
    ];

    // 3) Colors per category (adjust as desired)
    const categoryColors = {
      "Physical activities": "#FFF9E6",        // light yellow
      "Mental Relaxation": "#E6FFF9",           // light aqua
      "Cognitive Activities": "#F3E6FF",         // light lavender
      "Emotional and Social Engagement": "#FFE6F3" // light pink
    };

    // 4) Create a <select> element for each context
    function createSelect(name) {
      const select = document.createElement("select");
      select.name = name;
      // Insert "Empty" as default (not required)
      const optEmpty = new Option("Empty", "Empty", true, true);
      select.add(optEmpty);
      // Insert "Yes" option
      const optYes = new Option("Yes", "Yes");
      select.add(optYes);
      // Insert "No" option
      const optNo = new Option("No", "No");
      select.add(optNo);
      // On change, update cell color
      select.addEventListener("change", function() {
        updateCellColor(this);
      });
      return select;
    }

    // 5) Color the cell based on Yes or No
    function updateCellColor(select) {
      if (select.value === "Yes") {
        select.parentElement.style.backgroundColor = "lightgreen";
      } else if (select.value === "No") {
        select.parentElement.style.backgroundColor = "lightcoral";
      } else {
        // "Empty" => revert to the row's background color
        const rowBg = select.parentElement.parentElement.style.backgroundColor;
        select.parentElement.style.backgroundColor = rowBg;
      }
    }

    // 6) Build the table rows dynamically
    const tbody = document.querySelector("#tasksTable tbody");
    tasksData.forEach(group => {
      group.tasks.forEach((task, index) => {
        const row = document.createElement("tr");
        // Set row background color for the category
        row.style.backgroundColor = categoryColors[group.category] || "#ffffff";
        // Category cell (if first row in category, span the number of tasks)
        if (index === 0) {
          const categoryCell = document.createElement("td");
          categoryCell.classList.add("category-cell");
          categoryCell.rowSpan = group.tasks.length;
          categoryCell.textContent = group.category;
          row.appendChild(categoryCell);
        }
        // Task cell
        const taskCell = document.createElement("td");
        taskCell.textContent = task;
        row.appendChild(taskCell);
        // For each context, create a select element
        contexts.forEach(context => {
          const cell = document.createElement("td");
          const nameAttr = `${group.category}_${task}_${context}`
            .replace(/\s+/g, "_")
            .replace(/[()]/g, "");
          cell.appendChild(createSelect(nameAttr));
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    });

    // 7) Custom form submission handler with required validation
    document.getElementById('wellbeingForm').addEventListener('submit', function(e) {
      e.preventDefault(); // Prevent default form submission
      
      // Validate that all select fields are answered (not "Empty")
      const selects = document.querySelectorAll('select');
      for (const select of selects) {
        if (select.value === "Empty") {
          alert("Please answer all questions before submitting the form.");
          return; // Stop submission if any question is unanswered
        }
      }
      
      // Create FormData object from the form
      const formData = new FormData(this);
      
      // Convert FormData to URLSearchParams (URL-encoded format)
      const params = new URLSearchParams();
      for (const [key, value] of formData.entries()) {
        params.append(key, value);
      }
      
      // Log the data being sent (for debugging)
      console.log('Form data being sent:', params.toString());
      
      // Send the data using fetch with the correct Content-Type
      fetch('https://jsttjfi7za.execute-api.ap-south-1.amazonaws.com/ProcessWellbeingSubmission', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: params.toString() // Convert to URL-encoded string
      })
      .then(response => {
        // Check if the response is OK
        if (!response.ok) {
          throw new Error('Network response was not ok: ' + response.status);
        }
        // Handle HTML response
        return response.text();
      })
      .then(html => {
        // Replace the form with the success response
        document.querySelector('.container').innerHTML = html;
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error submitting form: ' + error.message);
      });
    });
  </script>
</body>
</html>
